"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[969],{343:(e,t,s)=>{s.d(t,{ToastProvider:()=>m,d:()=>u});var a=s(5155),l=s(2115),r=s(8661),d=s.n(r),n=s(6956),c=s(5380),o=s(3569);function i(e){let{message:t,type:s,onClose:r}=e;return(0,l.useEffect)(()=>{let e=setTimeout(()=>{r()},3e3);return()=>clearTimeout(e)},[r]),(0,a.jsxs)("div",{className:"jsx-20e3972b67dd0e11 "+"animate-slideInRight flex min-w-[300px] items-start gap-3 rounded-lg border p-4 shadow-lg ".concat("success"===s?"border-green-500/20 bg-green-500/10":"border-red-500/20 bg-red-500/10"),children:["success"===s?(0,a.jsx)(n.A,{className:"h-5 w-5 flex-shrink-0 text-green-500"}):(0,a.jsx)(c.A,{className:"h-5 w-5 flex-shrink-0 text-red-500"}),(0,a.jsx)("p",{className:"jsx-20e3972b67dd0e11 "+"flex-1 text-sm ".concat("success"===s?"text-green-100":"text-red-100"),children:t}),(0,a.jsx)("button",{onClick:r,className:"jsx-20e3972b67dd0e11 "+"flex-shrink-0 rounded p-0.5 transition-colors ".concat("success"===s?"text-green-400 hover:bg-green-500/20":"text-red-400 hover:bg-red-500/20"),children:(0,a.jsx)(o.A,{className:"h-4 w-4"})}),(0,a.jsx)(d(),{id:"20e3972b67dd0e11",children:"@keyframes slideInRight{from{opacity:0;transform:translatex(100%)}to{opacity:1;transform:translatex(0)}}.animate-slideInRight.jsx-20e3972b67dd0e11{animation:slideInRight.3s ease-out}"})]})}let x=(0,l.createContext)(void 0);function m(e){let{children:t}=e,[s,r]=(0,l.useState)([]),d=(0,l.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",s=Math.random().toString(36).substring(7),a={id:s,message:e,type:t};r(e=>[...e,a]),setTimeout(()=>{r(e=>e.filter(e=>e.id!==s))},3e3)},[]),n=(0,l.useCallback)(e=>{r(t=>t.filter(t=>t.id!==e))},[]);return(0,a.jsxs)(x.Provider,{value:{showToast:d},children:[t,(0,a.jsx)("div",{className:"fixed right-4 top-4 z-50 space-y-2",children:s.map(e=>(0,a.jsx)(i,{message:e.message,type:e.type,onClose:()=>n(e.id)},e.id))})]})}function u(){let e=(0,l.useContext)(x);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}},2350:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(5155),l=s(2115),r=s(9632),d=s(9731),n=s(9554),c=s(5748),o=s(343);function i(e){var t,s;let{dealId:i,isOpen:x,onClose:m,onDealUpdated:u,onDealDeleted:h}=e,{showToast:b}=(0,o.d)(),[f,g]=(0,l.useState)(!0),[p,j]=(0,l.useState)(!1),[v,N]=(0,l.useState)(!1),[y,w]=(0,l.useState)(null),[C,k]=(0,l.useState)([]),[F,S]=(0,l.useState)([]),[_,E]=(0,l.useState)(0),[A,D]=(0,l.useState)(""),[T,I]=(0,l.useState)(""),[z,P]=(0,l.useState)(50),[U,L]=(0,l.useState)(""),[O,M]=(0,l.useState)(""),[R,V]=(0,l.useState)(""),[W,$]=(0,l.useState)("Open"),[q,H]=(0,l.useState)({}),[J,Y]=(0,l.useState)(!1),[B,G]=(0,l.useState)(""),[K,Q]=(0,l.useState)(""),[X,Z]=(0,l.useState)(!1);(0,l.useEffect)(()=>{x&&i&&(ee(),et())},[x,i]);let ee=async()=>{try{var e;g(!0);let t=await fetch("/api/deals/".concat(i));if(!t.ok)throw Error("Failed to fetch deal");let s=await t.json();w(s.deal),k(s.history||[]),D(s.deal.title),I((null==(e=s.deal.value)?void 0:e.toString())||""),P(s.deal.probability||50),L(s.deal.stage.id),M(s.deal.expected_close_date||""),V(s.deal.notes||""),$(s.deal.status)}catch(e){console.error("Error fetching deal:",e),b("Failed to load deal details","error")}finally{g(!1)}},et=async()=>{try{let e=await fetch("/api/pipeline-stages");if(!e.ok)throw Error("Failed to fetch stages");let t=await e.json();S(t.stages),E(t.stages.length)}catch(e){console.error("Error fetching stages:",e)}},es=async()=>{if((()=>{let e={};if(A.trim()?A.length>200&&(e.title="Deal title must be 200 characters or less"):e.title="Deal title is required",T){let t=parseFloat(T);isNaN(t)||t<0?e.value="Value must be a positive number":t>99999999.99&&(e.value="Value must be less than $99,999,999.99")}return(z<0||z>100)&&(e.probability="Probability must be between 0 and 100"),U||(e.stageId="Please select a pipeline stage"),R&&R.length>2e3&&(e.notes="Notes must be 2000 characters or less"),H(e),0===Object.keys(e).length})())try{N(!0);let e={title:A.trim(),value:T?parseFloat(T):null,probability:z||null,stage_id:U,expected_close_date:O||null,notes:R.trim()||null,status:W,stage_change_notes:U!==(null==y?void 0:y.stage.id)?B:null},t=await fetch("/api/deals/".concat(i),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to update deal")}b("Deal updated successfully","success"),j(!1),ee(),u&&u()}catch(e){console.error("Error updating deal:",e),b(e.message||"Failed to update deal","error")}finally{N(!1)}},ea=async()=>{try{if(!(await fetch("/api/deals/".concat(i),{method:"DELETE"})).ok)throw Error("Failed to delete deal");b("Deal deleted","success"),Z(!1),m(),h&&h()}catch(e){console.error("Error deleting deal:",e),b("Failed to delete deal","error")}},el=()=>{p?confirm("You have unsaved changes. Are you sure you want to close?")&&(j(!1),m()):m()},er=e=>null===e?"N/A":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),ed=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A";return x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-40 bg-black/70",onClick:el}),(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:(0,a.jsx)("div",{className:"relative w-full max-w-4xl max-h-[90vh] overflow-hidden rounded-2xl border border-[#313244] bg-[#181825] shadow-2xl",onClick:e=>e.stopPropagation(),children:f?(0,a.jsx)("div",{className:"flex items-center justify-center py-32",children:(0,a.jsx)("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-[#313244] border-t-[#F25C05]"})}):y?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b border-[#313244] px-6 py-4",children:[(0,a.jsx)("button",{onClick:el,className:"rounded-lg p-2 text-[#a6adc8] transition-colors hover:bg-[#313244] hover:text-[#cdd6f4]",children:(0,a.jsx)(r.A,{className:"h-5 w-5"})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:!p&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>j(!0),className:"flex items-center gap-2 rounded-lg border border-[#313244] bg-transparent px-4 py-2 text-sm font-medium text-[#cdd6f4] transition-colors hover:bg-[#313244]",children:[(0,a.jsx)(d.A,{className:"h-4 w-4"}),"Edit"]}),(0,a.jsxs)("button",{onClick:()=>Z(!0),className:"flex items-center gap-2 rounded-lg border border-red-500/50 bg-transparent px-4 py-2 text-sm font-medium text-red-400 transition-colors hover:bg-red-500/20",children:[(0,a.jsx)(n.A,{className:"h-4 w-4"}),"Delete"]})]})})]}),(0,a.jsxs)("div",{className:"overflow-y-auto",style:{maxHeight:"calc(90vh - 140px)"},children:[(0,a.jsx)("div",{className:"border-b border-[#313244] px-6 py-6",children:p?(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{type:"text",value:A,onChange:e=>D(e.target.value),maxLength:200,className:"w-full rounded-lg border border-[#313244] bg-[#1e1e2e] px-4 py-2 text-xl font-bold text-[#cdd6f4] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05]"}),q.title&&(0,a.jsx)("p",{className:"mt-1 text-xs text-red-400",children:q.title})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h2",{className:"text-2xl font-extrabold text-[#cdd6f4]",children:y.title}),(0,a.jsxs)("p",{className:"mt-2 text-base font-semibold text-[#cdd6f4]",children:[er(y.value)," â€¢ ",y.probability||0,"% probability"]})]})}),!p&&(0,a.jsxs)("div",{className:"border-b border-[#313244] px-6 py-6",children:[(0,a.jsxs)("div",{className:"mb-2 flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-[#cdd6f4]",children:y.stage.name}),(0,a.jsxs)("span",{className:"text-[#a6adc8]",children:["Stage ",y.stage.order_num," of ",_]})]}),(0,a.jsx)("div",{className:"h-3 w-full overflow-hidden rounded-full bg-[#45475a]",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-[#F25C05] to-[#ff6b1a] transition-all",style:{width:"".concat(y&&0!==_?(y.stage.order_num-1)/(_-1)*100:0,"%")}})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 px-6 py-6 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-[#cdd6f4]",children:"Deal Information"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Contact"}),(0,a.jsxs)("p",{className:"text-base text-[#cdd6f4]",children:[y.contact.first_name," ",y.contact.last_name]}),y.contact.company&&(0,a.jsx)("p",{className:"text-sm text-[#a6adc8]",children:y.contact.company})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Value"}),p?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-[#a6adc8]",children:"$"}),(0,a.jsx)("input",{type:"text",value:T,onChange:e=>I(e.target.value.replace(/[^0-9.]/g,"")),placeholder:"0.00",className:"w-full rounded-lg border border-[#313244] bg-[#1e1e2e] pl-8 pr-4 py-2 text-[#cdd6f4] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05]"})]}),q.value&&(0,a.jsx)("p",{className:"mt-1 text-xs text-red-400",children:q.value})]}):(0,a.jsx)("p",{className:"text-base text-[#cdd6f4]",children:er(y.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Probability"}),p?(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("input",{type:"range",min:"0",max:"100",step:"5",value:z,onChange:e=>P(parseInt(e.target.value)),className:"flex-1"}),(0,a.jsx)("input",{type:"number",min:"0",max:"100",value:z,onChange:e=>P(Math.min(100,Math.max(0,parseInt(e.target.value)||0))),className:"w-20 rounded-lg border border-[#313244] bg-[#1e1e2e] px-3 py-2 text-center text-[#cdd6f4] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05]"}),(0,a.jsx)("span",{className:"text-[#a6adc8]",children:"%"})]}):(0,a.jsxs)("p",{className:"text-base text-[#cdd6f4]",children:[y.probability||0,"%"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Status"}),p?(0,a.jsx)("div",{className:"flex gap-3",children:["Open","Won","Lost"].map(e=>(0,a.jsx)("button",{onClick:()=>$(e),className:"flex-1 rounded-lg border px-4 py-2 text-sm font-medium transition-colors ".concat(W===e?"border-[#F25C05] bg-[#F25C05] text-white":"border-[#313244] bg-transparent text-[#cdd6f4] hover:bg-[#313244]"),children:e},e))}):(0,a.jsx)("span",{className:"inline-block rounded-md border px-3 py-1 text-xs font-semibold ".concat((e=>{switch(e){case"Open":return"bg-green-500/20 text-green-400 border-green-500/50";case"Won":return"bg-blue-500/20 text-blue-400 border-blue-500/50";case"Lost":return"bg-red-500/20 text-red-400 border-red-500/50";default:return"bg-[#313244] text-[#cdd6f4] border-[#313244]"}})(y.status)),children:y.status})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Pipeline Stage"}),p?(0,a.jsx)("select",{value:U,onChange:e=>{var t;(t=e.target.value)!==(null==y?void 0:y.stage.id)?(Q(t),Y(!0)):L(t)},className:"w-full rounded-lg border border-[#313244] bg-[#1e1e2e] px-4 py-2 text-[#cdd6f4] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05]",children:F.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.order_num,". ",e.name]},e.id))}):(0,a.jsx)("p",{className:"text-base text-[#cdd6f4]",children:y.stage.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Expected Close"}),p?(0,a.jsx)("input",{type:"date",value:O,onChange:e=>M(e.target.value),min:new Date().toISOString().split("T")[0],className:"w-full rounded-lg border border-[#313244] bg-[#1e1e2e] px-4 py-2 text-[#cdd6f4] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05]"}):(0,a.jsx)("p",{className:"text-base text-[#cdd6f4]",children:ed(y.expected_close_date)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Owner"}),(0,a.jsx)("p",{className:"text-base text-[#cdd6f4]",children:(null==(t=y.owner)?void 0:t.full_name)||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Created"}),(0,a.jsx)("p",{className:"text-base text-[#cdd6f4]",children:ed(y.created_at)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Updated"}),(0,a.jsx)("p",{className:"text-base text-[#cdd6f4]",children:ed(y.updated_at)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Notes"}),p?(0,a.jsxs)("div",{children:[(0,a.jsx)("textarea",{value:R,onChange:e=>V(e.target.value),rows:4,maxLength:2e3,className:"w-full rounded-lg border border-[#313244] bg-[#1e1e2e] px-4 py-2 text-[#cdd6f4] placeholder-[#6c7086] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05] resize-none",placeholder:"Add notes..."}),(0,a.jsx)("div",{className:"mt-1 flex justify-end",children:(0,a.jsxs)("span",{className:"text-xs text-[#6c7086]",children:[R.length,"/2000"]})}),q.notes&&(0,a.jsx)("p",{className:"text-xs text-red-400",children:q.notes})]}):(0,a.jsx)("p",{className:"text-base text-[#cdd6f4] whitespace-pre-wrap",children:y.notes||"No notes"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-[#cdd6f4]",children:"Stage Timeline"}),0===C.length?(0,a.jsx)("p",{className:"text-sm text-[#a6adc8]",children:"No stage changes yet"}):(0,a.jsx)("div",{className:"space-y-4",children:C.map((e,t)=>{var s,l;return(0,a.jsxs)("div",{className:"relative pl-6",children:[t<C.length-1&&(0,a.jsx)("div",{className:"absolute left-1 top-6 h-full w-0.5 bg-[#45475a]"}),(0,a.jsx)("div",{className:"absolute left-0 top-1.5 h-2 w-2 rounded-full bg-[#F25C05]"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-[#cdd6f4]",children:["Moved to ",(null==(s=e.to_stage)?void 0:s.name)||"Unknown"]}),(0,a.jsxs)("p",{className:"text-xs text-[#a6adc8]",children:[new Date(e.changed_at).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})," by ",(null==(l=e.changed_by_user)?void 0:l.full_name)||"Unknown"]}),e.notes&&(0,a.jsx)("p",{className:"mt-1 text-xs text-[#6c7086] italic",children:e.notes})]})]},e.id)})})]})]})]}),p&&(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3 border-t border-[#313244] px-6 py-4",children:[(0,a.jsx)("button",{onClick:()=>j(!1),disabled:v,className:"rounded-lg border border-[#313244] bg-transparent px-4 py-2 text-sm font-medium text-[#cdd6f4] transition-colors hover:bg-[#313244] disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:es,disabled:v,className:"flex items-center gap-2 rounded-lg bg-[#F25C05] px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-[#ff6b1a] disabled:opacity-50",children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Saving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{className:"h-4 w-4"}),"Save Changes"]})})]})]}):null})}),J&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-[60] bg-black/80",onClick:()=>Y(!1)}),(0,a.jsx)("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-2xl border border-[#313244] bg-[#1e1e2e] p-6 shadow-2xl",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold text-[#cdd6f4]",children:["Move deal to ",null==(s=F.find(e=>e.id===K))?void 0:s.name,"?"]}),(0,a.jsx)("p",{className:"mt-2 text-sm text-[#a6adc8]",children:"This will update the deal stage and record the change in history."}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block mb-2 text-sm font-medium text-[#cdd6f4]",children:"Add notes about this stage change (optional)"}),(0,a.jsx)("textarea",{value:B,onChange:e=>G(e.target.value),rows:3,className:"w-full rounded-lg border border-[#313244] bg-[#181825] px-4 py-2 text-[#cdd6f4] placeholder-[#6c7086] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05] resize-none",placeholder:"Add notes..."})]}),(0,a.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>Y(!1),className:"flex-1 rounded-lg border border-[#313244] bg-transparent px-4 py-2 text-sm font-medium text-[#cdd6f4] transition-colors hover:bg-[#313244]",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{L(K),Y(!1),G("")},className:"flex-1 rounded-lg bg-[#F25C05] px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-[#ff6b1a]",children:"Move to Stage"})]})]})})]}),X&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-[60] bg-black/80",onClick:()=>Z(!1)}),(0,a.jsx)("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-2xl border border-[#313244] bg-[#1e1e2e] p-6 shadow-2xl",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-red-500/20",children:(0,a.jsx)(n.A,{className:"h-6 w-6 text-red-400"})}),(0,a.jsx)("h3",{className:"text-xl font-bold text-[#cdd6f4]",children:"Delete Deal?"})]}),(0,a.jsx)("p",{className:"mt-4 text-sm text-[#a6adc8]",children:"This will permanently delete this deal and all history. This action cannot be undone."}),(0,a.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>Z(!1),className:"flex-1 rounded-lg border border-[#313244] bg-transparent px-4 py-2 text-sm font-medium text-[#cdd6f4] transition-colors hover:bg-[#313244]",children:"Cancel"}),(0,a.jsx)("button",{onClick:ea,className:"flex-1 rounded-lg bg-red-500 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-red-600",children:"Delete Deal"})]})]})})]})]}):null}}}]);