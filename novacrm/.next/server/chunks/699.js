"use strict";exports.id=699,exports.ids=[699],exports.modules={7425:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(38301);let e=d.forwardRef(function({title:a,titleId:b,...c},e){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},c),a?d.createElement("title",{id:b},a):null,d.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))})},7536:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(38301);let e=d.forwardRef(function({title:a,titleId:b,...c},e){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},c),a?d.createElement("title",{id:b},a):null,d.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))})},17080:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(38301);let e=d.forwardRef(function({title:a,titleId:b,...c},e){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},c),a?d.createElement("title",{id:b},a):null,d.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))})},41118:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(38301);let e=d.forwardRef(function({title:a,titleId:b,...c},e){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},c),a?d.createElement("title",{id:b},a):null,d.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))})},61796:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(38301);let e=d.forwardRef(function({title:a,titleId:b,...c},e){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},c),a?d.createElement("title",{id:b},a):null,d.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))})},78088:(a,b,c)=>{c.d(b,{A:()=>k});var d=c(21124),e=c(38301),f=c(7536),g=c(7425),h=c(41118),i=c(61796),j=c(22498);function k({dealId:a,isOpen:b,onClose:c,onDealUpdated:k,onDealDeleted:l}){let{showToast:m}=(0,j.d)(),[n,o]=(0,e.useState)(!0),[p,q]=(0,e.useState)(!1),[r,s]=(0,e.useState)(!1),[t,u]=(0,e.useState)(null),[v,w]=(0,e.useState)([]),[x,y]=(0,e.useState)([]),[z,A]=(0,e.useState)(0),[B,C]=(0,e.useState)(""),[D,E]=(0,e.useState)(""),[F,G]=(0,e.useState)(50),[H,I]=(0,e.useState)(""),[J,K]=(0,e.useState)(""),[L,M]=(0,e.useState)(""),[N,O]=(0,e.useState)("Open"),[P,Q]=(0,e.useState)({}),[R,S]=(0,e.useState)(!1),[T,U]=(0,e.useState)(""),[V,W]=(0,e.useState)(""),[X,Y]=(0,e.useState)(!1),Z=async()=>{try{o(!0);let b=await fetch(`/api/deals/${a}`);if(!b.ok)throw Error("Failed to fetch deal");let c=await b.json();u(c.deal),w(c.history||[]),C(c.deal.title),E(c.deal.value?.toString()||""),G(c.deal.probability||50),I(c.deal.stage.id),K(c.deal.expected_close_date||""),M(c.deal.notes||""),O(c.deal.status)}catch(a){console.error("Error fetching deal:",a),m("Failed to load deal details","error")}finally{o(!1)}},$=async()=>{if((()=>{let a={};if(B.trim()?B.length>200&&(a.title="Deal title must be 200 characters or less"):a.title="Deal title is required",D){let b=parseFloat(D);isNaN(b)||b<0?a.value="Value must be a positive number":b>99999999.99&&(a.value="Value must be less than $99,999,999.99")}return(F<0||F>100)&&(a.probability="Probability must be between 0 and 100"),H||(a.stageId="Please select a pipeline stage"),L&&L.length>2e3&&(a.notes="Notes must be 2000 characters or less"),Q(a),0===Object.keys(a).length})())try{s(!0);let b={title:B.trim(),value:D?parseFloat(D):null,probability:F||null,stage_id:H,expected_close_date:J||null,notes:L.trim()||null,status:N,stage_change_notes:H!==t?.stage.id?T:null},c=await fetch(`/api/deals/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to update deal")}m("Deal updated successfully","success"),q(!1),Z(),k&&k()}catch(a){console.error("Error updating deal:",a),m(a.message||"Failed to update deal","error")}finally{s(!1)}},_=async()=>{try{if(!(await fetch(`/api/deals/${a}`,{method:"DELETE"})).ok)throw Error("Failed to delete deal");m("Deal deleted","success"),Y(!1),c(),l&&l()}catch(a){console.error("Error deleting deal:",a),m("Failed to delete deal","error")}},aa=()=>{p?confirm("You have unsaved changes. Are you sure you want to close?")&&(q(!1),c()):c()},ab=a=>null===a?"N/A":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a),ac=a=>a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A";return b?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"fixed inset-0 z-40 bg-black/70",onClick:aa}),(0,d.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:(0,d.jsx)("div",{className:"relative w-full max-w-4xl max-h-[90vh] overflow-hidden rounded-2xl border border-[#313244] bg-[#181825] shadow-2xl",onClick:a=>a.stopPropagation(),children:n?(0,d.jsx)("div",{className:"flex items-center justify-center py-32",children:(0,d.jsx)("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-[#313244] border-t-[#F25C05]"})}):t?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"flex items-center justify-between border-b border-[#313244] px-6 py-4",children:[(0,d.jsx)("button",{onClick:aa,className:"rounded-lg p-2 text-[#a6adc8] transition-colors hover:bg-[#313244] hover:text-[#cdd6f4]",children:(0,d.jsx)(f.A,{className:"h-5 w-5"})}),(0,d.jsx)("div",{className:"flex items-center gap-2",children:!p&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("button",{onClick:()=>q(!0),className:"flex items-center gap-2 rounded-lg border border-[#313244] bg-transparent px-4 py-2 text-sm font-medium text-[#cdd6f4] transition-colors hover:bg-[#313244]",children:[(0,d.jsx)(g.A,{className:"h-4 w-4"}),"Edit"]}),(0,d.jsxs)("button",{onClick:()=>Y(!0),className:"flex items-center gap-2 rounded-lg border border-red-500/50 bg-transparent px-4 py-2 text-sm font-medium text-red-400 transition-colors hover:bg-red-500/20",children:[(0,d.jsx)(h.A,{className:"h-4 w-4"}),"Delete"]})]})})]}),(0,d.jsxs)("div",{className:"overflow-y-auto",style:{maxHeight:"calc(90vh - 140px)"},children:[(0,d.jsx)("div",{className:"border-b border-[#313244] px-6 py-6",children:p?(0,d.jsx)("div",{className:"space-y-4",children:(0,d.jsxs)("div",{children:[(0,d.jsx)("input",{type:"text",value:B,onChange:a=>C(a.target.value),maxLength:200,className:"w-full rounded-lg border border-[#313244] bg-[#1e1e2e] px-4 py-2 text-xl font-bold text-[#cdd6f4] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05]"}),P.title&&(0,d.jsx)("p",{className:"mt-1 text-xs text-red-400",children:P.title})]})}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h2",{className:"text-2xl font-extrabold text-[#cdd6f4]",children:t.title}),(0,d.jsxs)("p",{className:"mt-2 text-base font-semibold text-[#cdd6f4]",children:[ab(t.value)," â€¢ ",t.probability||0,"% probability"]})]})}),!p&&(0,d.jsxs)("div",{className:"border-b border-[#313244] px-6 py-6",children:[(0,d.jsxs)("div",{className:"mb-2 flex items-center justify-between text-sm",children:[(0,d.jsx)("span",{className:"font-medium text-[#cdd6f4]",children:t.stage.name}),(0,d.jsxs)("span",{className:"text-[#a6adc8]",children:["Stage ",t.stage.order_num," of ",z]})]}),(0,d.jsx)("div",{className:"h-3 w-full overflow-hidden rounded-full bg-[#45475a]",children:(0,d.jsx)("div",{className:"h-full bg-gradient-to-r from-[#F25C05] to-[#ff6b1a] transition-all",style:{width:`${!t||0===z?0:(t.stage.order_num-1)/(z-1)*100}%`}})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 gap-6 px-6 py-6 md:grid-cols-2",children:[(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-[#cdd6f4]",children:"Deal Information"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Contact"}),(0,d.jsxs)("p",{className:"text-base text-[#cdd6f4]",children:[t.contact.first_name," ",t.contact.last_name]}),t.contact.company&&(0,d.jsx)("p",{className:"text-sm text-[#a6adc8]",children:t.contact.company})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Value"}),p?(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-[#a6adc8]",children:"$"}),(0,d.jsx)("input",{type:"text",value:D,onChange:a=>E(a.target.value.replace(/[^0-9.]/g,"")),placeholder:"0.00",className:"w-full rounded-lg border border-[#313244] bg-[#1e1e2e] pl-8 pr-4 py-2 text-[#cdd6f4] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05]"})]}),P.value&&(0,d.jsx)("p",{className:"mt-1 text-xs text-red-400",children:P.value})]}):(0,d.jsx)("p",{className:"text-base text-[#cdd6f4]",children:ab(t.value)})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Probability"}),p?(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("input",{type:"range",min:"0",max:"100",step:"5",value:F,onChange:a=>G(parseInt(a.target.value)),className:"flex-1"}),(0,d.jsx)("input",{type:"number",min:"0",max:"100",value:F,onChange:a=>G(Math.min(100,Math.max(0,parseInt(a.target.value)||0))),className:"w-20 rounded-lg border border-[#313244] bg-[#1e1e2e] px-3 py-2 text-center text-[#cdd6f4] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05]"}),(0,d.jsx)("span",{className:"text-[#a6adc8]",children:"%"})]}):(0,d.jsxs)("p",{className:"text-base text-[#cdd6f4]",children:[t.probability||0,"%"]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Status"}),p?(0,d.jsx)("div",{className:"flex gap-3",children:["Open","Won","Lost"].map(a=>(0,d.jsx)("button",{onClick:()=>O(a),className:`flex-1 rounded-lg border px-4 py-2 text-sm font-medium transition-colors ${N===a?"border-[#F25C05] bg-[#F25C05] text-white":"border-[#313244] bg-transparent text-[#cdd6f4] hover:bg-[#313244]"}`,children:a},a))}):(0,d.jsx)("span",{className:`inline-block rounded-md border px-3 py-1 text-xs font-semibold ${(a=>{switch(a){case"Open":return"bg-green-500/20 text-green-400 border-green-500/50";case"Won":return"bg-blue-500/20 text-blue-400 border-blue-500/50";case"Lost":return"bg-red-500/20 text-red-400 border-red-500/50";default:return"bg-[#313244] text-[#cdd6f4] border-[#313244]"}})(t.status)}`,children:t.status})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Pipeline Stage"}),p?(0,d.jsx)("select",{value:H,onChange:a=>{var b;(b=a.target.value)!==t?.stage.id?(W(b),S(!0)):I(b)},className:"w-full rounded-lg border border-[#313244] bg-[#1e1e2e] px-4 py-2 text-[#cdd6f4] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05]",children:x.map(a=>(0,d.jsxs)("option",{value:a.id,children:[a.order_num,". ",a.name]},a.id))}):(0,d.jsx)("p",{className:"text-base text-[#cdd6f4]",children:t.stage.name})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Expected Close"}),p?(0,d.jsx)("input",{type:"date",value:J,onChange:a=>K(a.target.value),min:new Date().toISOString().split("T")[0],className:"w-full rounded-lg border border-[#313244] bg-[#1e1e2e] px-4 py-2 text-[#cdd6f4] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05]"}):(0,d.jsx)("p",{className:"text-base text-[#cdd6f4]",children:ac(t.expected_close_date)})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Owner"}),(0,d.jsx)("p",{className:"text-base text-[#cdd6f4]",children:t.owner?.name||"N/A"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Created"}),(0,d.jsx)("p",{className:"text-base text-[#cdd6f4]",children:ac(t.created_at)})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Updated"}),(0,d.jsx)("p",{className:"text-base text-[#cdd6f4]",children:ac(t.updated_at)})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block mb-1 text-sm font-semibold text-[#a6adc8]",children:"Notes"}),p?(0,d.jsxs)("div",{children:[(0,d.jsx)("textarea",{value:L,onChange:a=>M(a.target.value),rows:4,maxLength:2e3,className:"w-full rounded-lg border border-[#313244] bg-[#1e1e2e] px-4 py-2 text-[#cdd6f4] placeholder-[#6c7086] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05] resize-none",placeholder:"Add notes..."}),(0,d.jsx)("div",{className:"mt-1 flex justify-end",children:(0,d.jsxs)("span",{className:"text-xs text-[#6c7086]",children:[L.length,"/2000"]})}),P.notes&&(0,d.jsx)("p",{className:"text-xs text-red-400",children:P.notes})]}):(0,d.jsx)("p",{className:"text-base text-[#cdd6f4] whitespace-pre-wrap",children:t.notes||"No notes"})]})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("h3",{className:"text-lg font-bold text-[#cdd6f4]",children:"Stage Timeline"}),0===v.length?(0,d.jsx)("p",{className:"text-sm text-[#a6adc8]",children:"No stage changes yet"}):(0,d.jsx)("div",{className:"space-y-4",children:v.map((a,b)=>(0,d.jsxs)("div",{className:"relative pl-6",children:[b<v.length-1&&(0,d.jsx)("div",{className:"absolute left-1 top-6 h-full w-0.5 bg-[#45475a]"}),(0,d.jsx)("div",{className:"absolute left-0 top-1.5 h-2 w-2 rounded-full bg-[#F25C05]"}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("p",{className:"text-sm font-medium text-[#cdd6f4]",children:["Moved to ",a.to_stage?.name||"Unknown"]}),(0,d.jsxs)("p",{className:"text-xs text-[#a6adc8]",children:[new Date(a.changed_at).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})," by ",a.changed_by_user?.name||"Unknown"]}),a.notes&&(0,d.jsx)("p",{className:"mt-1 text-xs text-[#6c7086] italic",children:a.notes})]})]},a.id))})]})]})]}),p&&(0,d.jsxs)("div",{className:"flex items-center justify-end gap-3 border-t border-[#313244] px-6 py-4",children:[(0,d.jsx)("button",{onClick:()=>q(!1),disabled:r,className:"rounded-lg border border-[#313244] bg-transparent px-4 py-2 text-sm font-medium text-[#cdd6f4] transition-colors hover:bg-[#313244] disabled:opacity-50",children:"Cancel"}),(0,d.jsx)("button",{onClick:$,disabled:r,className:"flex items-center gap-2 rounded-lg bg-[#F25C05] px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-[#ff6b1a] disabled:opacity-50",children:r?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Saving..."]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(i.A,{className:"h-4 w-4"}),"Save Changes"]})})]})]}):null})}),R&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"fixed inset-0 z-[60] bg-black/80",onClick:()=>S(!1)}),(0,d.jsx)("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:(0,d.jsxs)("div",{className:"w-full max-w-md rounded-2xl border border-[#313244] bg-[#1e1e2e] p-6 shadow-2xl",children:[(0,d.jsxs)("h3",{className:"text-xl font-bold text-[#cdd6f4]",children:["Move deal to ",x.find(a=>a.id===V)?.name,"?"]}),(0,d.jsx)("p",{className:"mt-2 text-sm text-[#a6adc8]",children:"This will update the deal stage and record the change in history."}),(0,d.jsxs)("div",{className:"mt-4",children:[(0,d.jsx)("label",{className:"block mb-2 text-sm font-medium text-[#cdd6f4]",children:"Add notes about this stage change (optional)"}),(0,d.jsx)("textarea",{value:T,onChange:a=>U(a.target.value),rows:3,className:"w-full rounded-lg border border-[#313244] bg-[#181825] px-4 py-2 text-[#cdd6f4] placeholder-[#6c7086] focus:border-[#F25C05] focus:outline-none focus:ring-1 focus:ring-[#F25C05] resize-none",placeholder:"Add notes..."})]}),(0,d.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,d.jsx)("button",{onClick:()=>S(!1),className:"flex-1 rounded-lg border border-[#313244] bg-transparent px-4 py-2 text-sm font-medium text-[#cdd6f4] transition-colors hover:bg-[#313244]",children:"Cancel"}),(0,d.jsx)("button",{onClick:()=>{I(V),S(!1),U("")},className:"flex-1 rounded-lg bg-[#F25C05] px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-[#ff6b1a]",children:"Move to Stage"})]})]})})]}),X&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"fixed inset-0 z-[60] bg-black/80",onClick:()=>Y(!1)}),(0,d.jsx)("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:(0,d.jsxs)("div",{className:"w-full max-w-md rounded-2xl border border-[#313244] bg-[#1e1e2e] p-6 shadow-2xl",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-red-500/20",children:(0,d.jsx)(h.A,{className:"h-6 w-6 text-red-400"})}),(0,d.jsx)("h3",{className:"text-xl font-bold text-[#cdd6f4]",children:"Delete Deal?"})]}),(0,d.jsx)("p",{className:"mt-4 text-sm text-[#a6adc8]",children:"This will permanently delete this deal and all history. This action cannot be undone."}),(0,d.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,d.jsx)("button",{onClick:()=>Y(!1),className:"flex-1 rounded-lg border border-[#313244] bg-transparent px-4 py-2 text-sm font-medium text-[#cdd6f4] transition-colors hover:bg-[#313244]",children:"Cancel"}),(0,d.jsx)("button",{onClick:_,className:"flex-1 rounded-lg bg-red-500 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-red-600",children:"Delete Deal"})]})]})})]})]}):null}}};